(function(){$(function(){function u(){location.reload(!0)}function f(n,i){abp.message.confirm("Delete user '"+i+"'?",function(i){i&&t.delete({id:n}).done(function(){u()})})}var t=abp.services.app.user,e=$("#UsersTable"),r,n,i;console.log("1"+t);r=e.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:t.getAll,inputFilter:function(){return{filter:$("#UsersTableFilter").val()}}},columnDefs:[{targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"><\/i> '+app.localize("Actions")+' <span class="caret"><\/span>',items:[{text:app.localize("LoginAsThisUser"),visible:function(n){return _permissions.impersonation&&n.record.id!==abp.session.userId},action:function(n){abp.ajax({url:abp.appPath+"Account/Impersonate",data:JSON.stringify({tenantId:abp.session.tenantId,userId:n.record.id})})}},{text:app.localize("Edit"),visible:function(){return _permissions.edit},action:function(n){_createOrEditModal.open({id:n.record.id})}},{text:app.localize("Permissions"),visible:function(){return _permissions.changePermissions},action:function(n){_userPermissionsModal.open({id:n.record.id})}},{text:app.localize("Unlock"),visible:function(){return _permissions.changePermissions},action:function(n){t.unlockUser({id:n.record.id}).done(function(){abp.notify.success(app.localize("UnlockedTheUser",n.record.userName))})}},{text:app.localize("Delete"),visible:function(){return _permissions.delete},action:function(n){f(n.record)}}]}},{targets:1,data:"userName",render:function(n,t,i){var r=$("<span/>");if(i.profilePictureId){var u="/Profile/GetProfilePictureById?id="+i.profilePictureId,f=$("<a/>").attr("href",u).attr("target","_blank"),e=$("<img/>").addClass("img-circle").attr("src",u);f.append(e);r.append(f)}return r.append(n),r[0].outerHTML}},{targets:2,data:"name"},{targets:3,data:"surname"},{targets:4,data:"roles",render:function(n){for(var t="",i=0;i<n.length;i++)t.length&&(t=t+", "),t=t+n[i].roleName;return t}},{targets:5,data:"emailAddress"},{targets:6,data:"isEmailConfirmed",render:function(n){return n?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},{targets:7,data:"isActive",render:function(n){return n?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},{targets:8,data:"lastLoginTime",render:function(n){return n?moment(n).format("L"):""}},{targets:9,data:"creationTime",render:function(n){return moment(n).format("L")}}]});n=$("#UserCreateModal");i=n.find("form");i.validate({rules:{Password:"required",ConfirmPassword:{equalTo:"#Password"}}});$("#RefreshButton").click(function(){u()});$(".delete-user").click(function(){var n=$(this).attr("data-user-id"),t=$(this).attr("data-user-name");f(n,t)});$(".edit-user").click(function(n){var t=$(this).attr("data-user-id");n.preventDefault();$.ajax({url:abp.appPath+"Users/EditUserModal?userId="+t,type:"POST",contentType:"application/html",success:function(n){$("#UserEditModal div.modal-content").html(n)},error:function(){}})});i.find('button[type="submit"]').click(function(r){var u,f,e,o;if(r.preventDefault(),i.valid()){if(u=i.serializeFormToObject(),u.roleNames=[],f=$("input[name='role']:checked"),f)for(e=0;e<f.length;e++)o=$(f[e]),u.roleNames.push(o.val());abp.ui.setBusy(n);t.create(u).done(function(){n.modal("hide");location.reload(!0)}).always(function(){abp.ui.clearBusy(n)})}});n.on("shown.bs.modal",function(){n.find("input:not([type=hidden]):first").focus()})})})();